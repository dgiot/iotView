(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2a7b4745"],{"053f":function(e,t,i){},"05d6":function(e,t,i){"use strict";i("1754")},"11ac":function(e,t,i){"use strict";var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"baidumap",style:{width:"100%",height:"100%"}},[e.mapFlag?i("baidu-map",{staticClass:"baidu_map",attrs:{id:"baidu_map",ak:e.ak,center:e.center,"scroll-wheel-zoom":!0,zoom:e.sizeZoom},on:{ready:e.handler,click:e.handleMapClick}},[i("bm-map-type",{attrs:{anchor:"BMAP_ANCHOR_TOP_LEFT","map-types":["BMAP_HYBRID_MAP","BMAP_NORMAL_MAP"]}}),i("bm-overview-map",{attrs:{"is-open":!0}}),i("bm-scale",{attrs:{offset:{width:260,height:0}}}),i("bm-city-list",{attrs:{offset:{width:330,height:0}}}),i("bml-marker-clusterer",{attrs:{"average-center":!0}},e._l(e.deviceList,(function(t,a){return i("div",{key:a},[i("bm-marker",{ref:"bm_info"+a,refInFor:!0,attrs:{position:{lng:t.location.longitude,lat:t.location.latitude}},on:{click:function(i){return e.showDeatils(t,a)}}},[i("bm-info-window",{key:a,staticStyle:{display:"none"},attrs:{position:{lng:t.location.longitude,lat:t.location.latitude},show:t.show},on:{close:function(i){return e.closeInfo(t,a)}}},[i("div",{directives:[{name:"show",rawName:"v-show",value:e.deviceInfo,expression:"deviceInfo"}],staticClass:"deviceInfo",staticStyle:{width:"400px"}},[i("el-row",{attrs:{gutter:24}},[i("el-col",{attrs:{span:24}},[i("div",{staticStyle:{display:"flex","justify-content":"space-between"}},[i("h2",{staticStyle:{"font-weight":"600"}},[e._v(e._s(e.deviceInfo.name))]),i("el-link",{staticStyle:{"margin-right":"16px"},attrs:{type:"ONLINE"===e.deviceInfo.status?"success":"danger",underline:!1}},[i("span",{staticClass:"circle",class:"ONLINE"===e.deviceInfo.status?"success":"warning"}),e._v(" "+e._s("ONLINE"===e.deviceInfo.status?"在线":"离线")+" ")])],1),i("div",{staticStyle:{color:"#ccc"}},[e._v(" 编号："+e._s(e.deviceInfo.devaddr)+" ")]),i("div",{staticStyle:{color:"#ccc"}},[e._v(" 位置："+e._s(e.deviceInfo.address)+" ")]),i("p",[i("el-button",{attrs:{type:"success"},on:{click:function(t){return e.handleOpenRealCard(e.deviceInfo)}}},[e._v(" 实时数据 ")]),i("el-button",{on:{click:function(t){return e.handleOpenTopo(e.deviceInfo)}}},[e._v(" 组态 ")])],1)])],1)],1)])],1)],1)})),0)],1):e._e(),i("el-dialog",{staticClass:"device_wrap",attrs:{title:e.deviceInfo.name,"append-to-body":!0,top:"10vh",visible:e.dialogDeviceVisible},on:{close:e.handlecloseDevice,"update:visible":function(t){e.dialogDeviceVisible=t}}},[i("real-card",{attrs:{cardList:e.cardList,avator:e.avator}})],1),e.dialogTopoVisible?i("div",{staticClass:"topo_wrap"},[i("div",{staticClass:"topo_contentwrap"},[i("div",{staticClass:"topo_title_top"},[i("div",[e._v(e._s(e.deviceInfo.name))]),i("span",{staticStyle:{cursor:"pointer"},on:{click:e.closeTopo}},[e._v("x")])]),i("div",{staticClass:"topo_content"},[i("topo-device",{staticClass:"wrap_konva",attrs:{deviceInfo:e.deviceInfo}})],1)])]):e._e(),e.dialogTopoAmisVisible?i("el-dialog",{attrs:{top:"10vh","append-to-body":!0,width:"1240px",visible:e.dialogTopoAmisVisible},on:{close:e.handlecloseDevice,"update:visible":function(t){e.dialogTopoAmisVisible=t}}},[i("amis",{attrs:{"modal-append-to-body":"",schema:e.topoAmisData,"show-help":!1}})],1):e._e()],1)},n=[],o=i("2909"),r=i("c7eb"),s=i("1da1"),c=(i("d81d"),i("ace4"),i("d3b7"),i("5cc6"),i("907a"),i("9a8c"),i("a975"),i("735e"),i("c1ac"),i("d139"),i("3a7b"),i("986a"),i("1d02"),i("d5d6"),i("82f8"),i("e91f"),i("60bd"),i("5f96"),i("3280"),i("3fcc"),i("ca91"),i("25a1"),i("cd26"),i("3c5d"),i("2954"),i("649e"),i("219c"),i("170b"),i("b39a"),i("1b3b"),i("3d71"),i("72f7"),i("c6e3"),i("b64b"),i("159b"),i("7db0"),i("498a"),i("b0c0"),i("14d9"),i("caad"),i("2532"),i("6062"),i("3ca3"),i("ddb0"),i("bd0c")),d=i("90be"),l=i("264a"),u=i("c7d9"),h=i("ae53"),p=i("fca4"),m=i("ad0f"),A=i("a598"),f=i("e6a3"),g=i("a458"),b=i("9f28"),v=i("624b"),y=i("1285"),w=i("59d7"),I=i.n(w),x=i("e762"),C=i("39c4"),k=i("8ba7"),S={name:"ScreenBaidumap",components:{BmPointCollection:c["BmPointCollection"],BmInfoWindow:c["BmInfoWindow"],BmScale:c["BmScale"],BmMapType:c["BmMapType"],BmOverviewMap:c["BmOverviewMap"],BmPanorama:c["BmPanorama"],BmControl:c["BmControl"],BmLabel:c["BmLabel"],BaiduMap:c["BaiduMap"],BmNavigation:c["BmNavigation"],BmGeolocation:c["BmGeolocation"],BmCityList:c["BmCityList"],BmMarker:c["BmMarker"],BmlMarkerClusterer:c["BmlMarkerClusterer"],BmPolyline:c["BmPolyline"],RealCard:d["a"],amis:A["a"],TopoCaltable:u["a"],ScreenDevice:h["a"],ScreenRealcard:m["a"],WorkOrder:p["a"],DgiotAliplayer:l["a"],ScreenLine:f["a"],ScreenDeviceBar:g["a"],DgiotNotification1:v["a"],TopoDevice:b["a"]},props:{comp:{type:Object,default:function(){return{type:"line",width:400,hieght:72}}}},emits:["initScreen"],data:function(){return{avator:I.a,dialogDeviceVisible:!1,dialogTopoVisible:!1,ak:"S7pehghn5BdQeSGZAcpEk4bLQSQ8czvi",sizeZoom:12,mapFlag:!1,center:{lng:120.260545,lat:31.551162},deviceList:[],cardList:[],productIco:"",deviceInfo:{},devicetopo:{},devicelayer:"",devicestage:"",vueComponents:[],amisComponents:[],vueFlag:!1,amisFlag:!1,dialogTopoAmisVisible:!1,topoAmisData:{},styleJson:[{featureType:"water",elementType:"all",stylers:{color:"#021019"}},{featureType:"highway",elementType:"geometry.fill",stylers:{color:"#000000"}},{featureType:"highway",elementType:"geometry.stroke",stylers:{color:"#147a92"}},{featureType:"arterial",elementType:"geometry.fill",stylers:{color:"#000000"}},{featureType:"arterial",elementType:"geometry.stroke",stylers:{color:"#0b3d51"}},{featureType:"local",elementType:"geometry",stylers:{color:"#000000"}},{featureType:"land",elementType:"all",stylers:{color:"#08304b"}},{featureType:"railway",elementType:"geometry.fill",stylers:{color:"#000000"}},{featureType:"railway",elementType:"geometry.stroke",stylers:{color:"#08304b"}},{featureType:"subway",elementType:"geometry",stylers:{lightness:-70}},{featureType:"building",elementType:"geometry.fill",stylers:{color:"#000000"}},{featureType:"all",elementType:"labels.text.fill",stylers:{color:"#857f7f"}},{featureType:"all",elementType:"labels.text.stroke",stylers:{color:"#000000"}},{featureType:"building",elementType:"geometry",stylers:{color:"#022338"}},{featureType:"green",elementType:"geometry",stylers:{color:"#062032"}},{featureType:"boundary",elementType:"all",stylers:{color:"#1e1c1c"}},{featureType:"manmade",elementType:"geometry",stylers:{color:"#022338"}},{featureType:"poi",elementType:"all",stylers:{visibility:"off"}},{featureType:"all",elementType:"labels.icon",stylers:{visibility:"off"}},{featureType:"all",elementType:"labels.text.fill",stylers:{color:"#2da0c6",visibility:"on"}}]}},created:function(){var e=this;return Object(s["a"])(Object(r["a"])().mark((function t(){return Object(r["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.comp.text&&(e.ak=e.comp.text);case 1:case"end":return t.stop()}}),t)})))()},mounted:function(){var e=this;return Object(s["a"])(Object(r["a"])().mark((function t(){return Object(r["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.queryDevice();case 2:e.mapFlag=!0,e.$dgiotBus.$off("device/transmit"),e.$dgiotBus.$on("device/transmit",(function(t){console.log("接受了",t),e.center={lng:t.location.longitude,lat:t.location.latitude},e.sizeZoom=15}));case 5:case"end":return t.stop()}}),t)})))()},methods:{handler:function(e){e.BMap;var t=e.map;t.setMapType(BMAP_HYBRID_MAP)},closeTopo:function(){this.amisFlag=!1,this.vueFlag=!1,this.dialogTopoVisible=!1,this.$emit("initScreen")},handleOpenTopo:function(e){var t=this;return Object(s["a"])(Object(r["a"])().mark((function i(){var a,n,o,s,c,d;return Object(r["a"])().wrap((function(i){while(1)switch(i.prev=i.next){case 0:return n={count:"objectId",order:"-updatedAt",excludeKeys:"data",skip:0,where:{class:{$regex:"Product"},type:{$regex:"Topo"},key:{$regex:e.product.objectId}}},localStorage.setItem("parse_objectId",e.objectId),t.vueComponents=[],t.amisComponents=[],i.next=6,Object(k["d"])(n);case 6:if(o=i.sent,console.log("组态",o),0!=o.results.length){i.next=11;break}return t.$message("暂未配置组态"),i.abrupt("return");case 11:return s={productid:e.product.objectId,devaddr:e.devaddr,viewid:(null===(a=o.results[0])||void 0===a?void 0:a.objectId)||""},i.next=14,Object(k["a"])(s);case 14:c=i.sent,t.devicetopo=c.data.Stage,d={topic:"$dg/user/konva/".concat(e.objectId,"/report")},t.dialogTopoVisible=!0,console.log("this.deviceInfo",t.deviceInfo),t.sendTopic(d),setTimeout((function(){t.initDeviceKonva()}),2e3);case 21:case"end":return i.stop()}}),i)})))()},initDeviceKonva:function(){var e=this;this.devicelayer=Konva.Node.create(this.devicetopo,"deviceTopo").findOne("Layer"),this.devicestage=new Konva.Stage({container:"deviceTopo",width:1200,height:700}),this.devicestage.add(this.devicelayer),this.$dgiotBus.$off("$dg/user/konva"),this.$dgiotBus.$on("$dg/user/konva",(function(t){var i=String.fromCharCode.apply(null,new Uint8Array(t)),a=JSON.parse(x["a"].decode(i));console.log(a),a.konva.forEach((function(t){e.putNode(e.devicestage,t.id,t.text,t.type)}))})),this.handleInitKonva()},putNode:function(e,t,i,a){if("undefined"!=a){var n={};n[a]=i,console.log(t,i),e.find("#".concat(t)).forEach((function(e){console.log(e),e.setAttrs(n)})),this.devicelayer.batchDraw()}},handleInitKonva:function(){var e=this;return Object(s["a"])(Object(r["a"])().mark((function t(){var i,a,n,o;return Object(r["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:i=[],a=[],e.devicestage.find("Label").forEach((function(e){e.setAttrs({draggable:!1})})),e.devicestage.find("Text").forEach((function(t){t.setAttrs({draggable:!1}),t.on("touchend",function(){var i=Object(s["a"])(Object(r["a"])().mark((function i(a){var n,o,s;return Object(r["a"])().wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(console.log("touchend",t),!t.attrs.bind_amis){i.next=11;break}return localStorage.setItem("parse_objectid",e.deviceInfo.objectId),localStorage.setItem("parse_productid",e.deviceInfo.product.objectId),n={viewid:t.attrs.amis_id},o={render:{text:t.attrs.text.trim()}},i.next=8,Object(k["c"])(n,o);case 8:s=i.sent,e.topoAmisData=s.data,e.dialogTopoAmisVisible=!0;case 11:case"end":return i.stop()}}),i)})));return function(e){return i.apply(this,arguments)}}()),t.on("click",function(){var i=Object(s["a"])(Object(r["a"])().mark((function i(a){var n,o,s;return Object(r["a"])().wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(console.log("click",t),!t.attrs.bind_amis){i.next=11;break}return localStorage.setItem("parse_objectid",e.deviceInfo.objectId),localStorage.setItem("parse_productid",e.deviceInfo.product.objectId),n={viewid:t.attrs.amis_id},o={render:{text:t.attrs.text.trim()}},i.next=8,Object(k["c"])(n,o);case 8:s=i.sent,e.topoAmisData=s.data,e.dialogTopoAmisVisible=!0;case 11:case"end":return i.stop()}}),i)})));return function(e){return i.apply(this,arguments)}}())})),e.devicestage.find("Image").forEach((function(t){if(t.setAttrs({draggable:!1}),"konvaimage"==t.attrs.type||"vuecomponent"==t.attrs.name){var n=t.attrs;i.push(n)}else if("amiscomponent"==t.attrs.name){var o=t.attrs;a.push(o)}else if(t.attrs.id.indexOf("不")<0){var r=new Image;t.setAttrs({image:r}),r.src=t.attrs.src.includes("//")?t.attrs.src:e.$FileServe+t.attrs.src}})),e.devicestage.find("Rect").forEach((function(e){if(e.setAttrs({draggable:!1}),"vuecomponent"==e.attrs.name){var t=e.attrs;i.push(t)}else if("amiscomponent"==e.attrs.name){var n=e.attrs;a.push(n)}})),e.devicelayer.batchDraw(),setTimeout((function(){console.log("第一次重绘"),e.devicelayer.batchDraw()}),500),setTimeout((function(){console.log("第二次重绘"),e.devicelayer.batchDraw()}),1e3),e.vueComponents=i,e.vueFlag=!0,e.amisComponents=a,n=0;case 13:if(!(n<e.amisComponents.length)){t.next=21;break}return t.next=16,Object(k["b"])(e.amisComponents[n].id);case 16:o=t.sent,e.amisComponents[n].viewData=o.data.data;case 18:n++,t.next=13;break;case 21:e.amisFlag=!0;case 22:case"end":return t.stop()}}),t)})))()},handlecloseDevice:function(){console.log("关闭实时数据弹窗"),this.$emit("initScreen")},handleOpenRealCard:function(e){var t=this;return Object(s["a"])(Object(r["a"])().mark((function i(){var a,n;return Object(r["a"])().wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.next=2,Object(y["b"])(e.objectId);case 2:a=i.sent,t.cardList=t.renderCard(a.data),console.log("thiscardList",t.cardList),n={topic:"$dg/user/realtimecard/".concat(e.objectId,"/report")},t.$dgiotBus.$off("$dg/user/realtimecard/".concat(e.objectId)),t.$dgiotBus.$on("$dg/user/realtimecard/".concat(e.objectId),(function(e){var i=String.fromCharCode.apply(null,new Uint8Array(e)),a=JSON.parse(x["a"].decode(i));console.log("实时卡片 ",a),t.cardList=t.renderCard(a.data)})),t.sendTopic(n),t.dialogDeviceVisible=!0;case 10:case"end":return i.stop()}}),i)})))()},sendTopic:function(e){Object(C["d"])(e).then((function(e){console.log(e)}))},renderCard:function(e){var t=[];e.forEach((function(e){e.devicetype=""===e.devicetype?"default":e.devicetype,e.devicetype&&t.push(e.devicetype)})),t=Object(o["a"])(new Set(t)),console.log("类别",t);var i=[];return t.forEach((function(t){var a={},n=[];e.forEach((function(e){t==e.devicetype&&n.push(e)})),a["data"]=n,a["name"]=t,i.push(a)})),i},closeInfo:function(e,t){e.show=!1},showDeatils:function(e,t){var i=this;return Object(s["a"])(Object(r["a"])().mark((function a(){return Object(r["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return i.productIco="",a.next=3,Object(y["a"])(e.objectId);case 3:i.deviceInfo=a.sent,console.log("this.deviceInfo",i.deviceInfo),i.$dgiotBus.$emit("device/historylinedata",e),i.$dgiotBus.$emit("device/historybardata",e),i.deviceList[t].show=!0;case 8:case"end":return a.stop()}}),a)})))()},queryDevice:function(){var e=this;return Object(s["a"])(Object(r["a"])().mark((function t(){var i,a,n,o,s,c;return Object(r["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return i={skip:0,order:"-createdAt",count:"objectId",where:{},limit:10},t.next=3,Object(y["e"])(i);case 3:a=t.sent,n=a.results,o=void 0===n?[]:n,s=a.count,void 0===s?0:s,c=!0,o.forEach((function(t){var i,a,n,o;(t.address=""==t.address||void 0==t.address?"---":t.address,t.show=!1,c&&null!==(i=t.location)&&void 0!==i&&i.latitude&&null!==(a=t.location)&&void 0!==a&&a.longitude)&&(e.center={lng:null===(n=t.location)||void 0===n?void 0:n.longitude,lat:null===(o=t.location)||void 0===o?void 0:o.latitude},c=!1)})),e.deviceList=o;case 11:case"end":return t.stop()}}),t)})))()},handleMapClick:function(e){return Object(s["a"])(Object(r["a"])().mark((function t(){var i;return Object(r["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:console.log("单击地图事件",e),i={__type:"GeoPoint",latitude:e.point.lat,longitude:e.point.lng},{limit:10,where:{location:{$nearSphere:i,$maxDistanceInMiles:10}}};case 3:case"end":return t.stop()}}),t)})))()}}},E=S,B=(i("05d6"),i("2877")),_=Object(B["a"])(E,a,n,!1,null,"bd59cce8",null);t["a"]=_.exports},1754:function(e,t,i){},"1b8a":function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAxgAAAGpCAIAAACBFgfKAAAACXBIWXMAABJ0AAASdAHeZh94AAAAEXRFWHRTb2Z0d2FyZQBTbmlwYXN0ZV0Xzt0AAAdjSURBVHic7dbBDcAgEMCw0v13PmYgH4RkT5Bn1sx8AACc+28HAAC8ykgBAERGCgAgMlIAAJGRAgCIjBQAQGSkAAAiIwUAEBkpAIDISAEAREYKACAyUgAAkZECAIiMFABAZKQAACIjBQAQGSkAgMhIAQBERgoAIDJSAACRkQIAiIwUAEBkpAAAIiMFABAZKQCAyEgBAERGCgAgMlIAAJGRAgCIjBQAQGSkAAAiIwUAEBkpAIDISAEAREYKACAyUgAAkZECAIiMFABAZKQAACIjBQAQGSkAgMhIAQBERgoAIDJSAACRkQIAiIwUAEBkpAAAIiMFABAZKQCAyEgBAERGCgAgMlIAAJGRAgCIjBQAQGSkAAAiIwUAEBkpAIDISAEAREYKACAyUgAAkZECAIiMFABAZKQAACIjBQAQGSkAgMhIAQBERgoAIDJSAACRkQIAiIwUAEBkpAAAIiMFABAZKQCAyEgBAERGCgAgMlIAAJGRAgCIjBQAQGSkAAAiIwUAEBkpAIDISAEAREYKACAyUgAAkZECAIiMFABAZKQAACIjBQAQGSkAgMhIAQBERgoAIDJSAACRkQIAiIwUAEBkpAAAIiMFABAZKQCAyEgBAERGCgAgMlIAAJGRAgCIjBQAQGSkAAAiIwUAEBkpAIDISAEAREYKACAyUgAAkZECAIiMFABAZKQAACIjBQAQGSkAgMhIAQBERgoAIDJSAACRkQIAiIwUAEBkpAAAIiMFABAZKQCAyEgBAERGCgAgMlIAAJGRAgCIjBQAQGSkAAAiIwUAEBkpAIDISAEAREYKACAyUgAAkZECAIiMFABAZKQAACIjBQAQGSkAgMhIAQBERgoAIDJSAACRkQIAiIwUAEBkpAAAIiMFABAZKQCAyEgBAERGCgAgMlIAAJGRAgCIjBQAQGSkAAAiIwUAEBkpAIDISAEAREYKACAyUgAAkZECAIiMFABAZKQAACIjBQAQGSkAgMhIAQBERgoAIDJSAACRkQIAiIwUAEBkpAAAIiMFABAZKQCAyEgBAERGCgAgMlIAAJGRAgCIjBQAQGSkAAAiIwUAEBkpAIDISAEAREYKACAyUgAAkZECAIiMFABAZKQAACIjBQAQGSkAgMhIAQBERgoAIDJSAACRkQIAiIwUAEBkpAAAIiMFABAZKQCAyEgBAERGCgAgMlIAAJGRAgCIjBQAQGSkAAAiIwUAEBkpAIDISAEAREYKACAyUgAAkZECAIiMFABAZKQAACIjBQAQGSkAgMhIAQBERgoAIDJSAACRkQIAiIwUAEBkpAAAIiMFABAZKQCAyEgBAERGCgAgMlIAAJGRAgCIjBQAQGSkAAAiIwUAEBkpAIDISAEAREYKACAyUgAAkZECAIiMFABAZKQAACIjBQAQGSkAgMhIAQBERgoAIDJSAACRkQIAiIwUAEBkpAAAIiMFABAZKQCAyEgBAERGCgAgMlIAAJGRAgCIjBQAQGSkAAAiIwUAEBkpAIDISAEAREYKACAyUgAAkZECAIiMFABAZKQAACIjBQAQGSkAgMhIAQBERgoAIDJSAACRkQIAiIwUAEBkpAAAIiMFABAZKQCAyEgBAERGCgAgMlIAAJGRAgCIjBQAQGSkAAAiIwUAEBkpAIDISAEAREYKACAyUgAAkZECAIiMFABAZKQAACIjBQAQGSkAgMhIAQBERgoAIDJSAACRkQIAiIwUAEBkpAAAIiMFABAZKQCAyEgBAERGCgAgMlIAAJGRAgCIjBQAQGSkAAAiIwUAEBkpAIDISAEAREYKACAyUgAAkZECAIiMFABAZKQAACIjBQAQGSkAgMhIAQBERgoAIDJSAACRkQIAiIwUAEBkpAAAIiMFABAZKQCAyEgBAERGCgAgMlIAAJGRAgCIjBQAQGSkAAAiIwUAEBkpAIDISAEAREYKACAyUgAAkZECAIiMFABAZKQAACIjBQAQGSkAgMhIAQBERgoAIDJSAACRkQIAiIwUAEBkpAAAIiMFABAZKQCAyEgBAERGCgAgMlIAAJGRAgCIjBQAQGSkAAAiIwUAEBkpAIDISAEAREYKACAyUgAAkZECAIiMFABAZKQAACIjBQAQGSkAgMhIAQBERgoAIDJSAACRkQIAiIwUAEBkpAAAIiMFABAZKQCAyEgBAERGCgAgMlIAAJGRAgCIjBQAQGSkAAAiIwUAEBkpAIDISAEAREYKACAyUgAAkZECAIiMFABAZKQAACIjBQAQGSkAgMhIAQBERgoAIDJSAACRkQIAiIwUAEBkpAAAIiMFABAZKQCAyEgBAERGCgAgMlIAAJGRAgCIjBQAQGSkAAAiIwUAEBkpAIDISAEAREYKACAyUgAAkZECAIiMFABAZKQAACIjBQAQGSkAgMhIAQBERgoAIDJSAACRkQIAiIwUAEBkpAAAIiMFABAZKQCAyEgBAERGCgAgMlIAAJGRAgCIjBQAQGSkAAAiIwUAEBkpAIDISAEAREYKACAyUgAAkZECAIiMFABAZKQAACIjBQAQbTfyBk9DMusQAAAAAElFTkSuQmCC"},"1d10":function(e,t,i){"use strict";i("a13d")},"1df5":function(e,t,i){"use strict";i("4289")},"32db":function(e,t,i){"use strict";var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"topoPie",style:{width:e.comp.width+"px",height:e.comp.height+"px"}},[i("div",{staticClass:"screen_right_bottom_top"},[e._v("设备状况占比")]),i("ve-pie",{attrs:{data:e.chartData,extend:e.extend,height:"100%",settings:e.chartSettings,width:"100%"}})],1)},n=[],o=i("c7eb"),r=i("1da1"),s=i("5530"),c=(i("99af"),i("ace4"),i("d3b7"),i("5cc6"),i("907a"),i("9a8c"),i("a975"),i("735e"),i("c1ac"),i("d139"),i("3a7b"),i("986a"),i("1d02"),i("d5d6"),i("82f8"),i("e91f"),i("60bd"),i("5f96"),i("3280"),i("3fcc"),i("ca91"),i("25a1"),i("cd26"),i("3c5d"),i("2954"),i("649e"),i("219c"),i("170b"),i("b39a"),i("1b3b"),i("3d71"),i("72f7"),i("c6e3"),i("b64b"),i("2f62")),d={name:"TopoPie",props:{comp:{type:Object,default:function(){return{type:"line",width:200,hieght:120}}}},data:function(){return this.chartSettings={type:"pie"},this.extend={series:{type:"pie",radius:["20%","50%"],center:["50%","50%"],itemStyle:{borderRadius:2,borderColor:"#fff",borderWidth:1}},legend:{textStyle:{color:"#fff"}},xAxis:{axisLine:{lineStyle:{color:"#fff"}}},yAxis:{axisLine:{lineStyle:{color:"#fff"}}}},{top:10,chartData:{columns:["名称","数量"],rows:[{"名称":"产品","数量":8},{"名称":"设备","数量":0},{"名称":"告警数","数量":15}]},timer:""}},computed:Object(s["a"])({},Object(c["b"])(["_dev_online_count","_dev_off_count"])),watch:{},created:function(){this.chartData={columns:["名称","数量"],rows:[{"名称":"开机数","数量":0},{"名称":"关机数","数量":0}]}},mounted:function(){var e=this;this.topic="/".concat(this.comp.type,"/").concat(this.comp.id,"/report"),this.$dgiotBus.$off(this.topic),this.$dgiotBus.$on(this.topic,(function(t){var i=String.fromCharCode.apply(null,new Uint8Array(t)),a=JSON.parse(Base64.decode(i));e.chartData=a,e.text=a.lable,e.value=a.value}))},destroyed:function(){clearInterval(this.timer)},methods:{queryChart:function(e){var t=this;return Object(r["a"])(Object(o["a"])().mark((function i(){var a,n,r;return Object(o["a"])().wrap((function(i){while(1)switch(i.prev=i.next){case 0:return a=(new Date).getTime(),n=a-6048e5,r={starttime:n,endtime:a,interval:"30m",keys:"*",limit:50,function:"last",style:"line"},i.next=5,getDabDevice(e,r).then((function(e){var i;if(console.log(e,"res charts"),(null===e||void 0===e||null===(i=e.chartData)||void 0===i?void 0:i.rows.length)>0){var a=e.chartData,n=void 0===a?{}:a;t.chartData=n,t.$nextTick((function(){setTimeout((function(){t.loading=!0,t.toggleChart("line")}),1e3)}))}console.log("this.chartData",t.chartData),t.loading=!1,t.dataEmpty=!1})).catch((function(e){console.log(e),t.loading=!1}));case 5:case"end":return i.stop()}}),i)})))()}}},l=d,u=(i("f2aa"),i("2877")),h=Object(u["a"])(l,a,n,!1,null,"e85dfd2c",null);t["a"]=h.exports},"38bc":function(e,t,i){},4289:function(e,t,i){},"4a1d":function(e,t,i){"use strict";i("a517")},5335:function(e,t,i){"use strict";i("053f")},"55f4":function(e,t,i){"use strict";i("cb78")},"5f51":function(e,t,i){},6775:function(e,t,i){},"75c0":function(e,t,i){},"766c":function(e,t,i){"use strict";var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticStyle:{width:"100%",height:"100%"},attrs:{id:"map"}})},n=[],o=i("c7eb"),r=i("1da1"),s=(i("d81d"),{name:"ScreenSgmap",components:{},props:{comp:{type:Object,default:function(){return{type:"line",width:400,hieght:72}}}},emits:["initScreen"],data:function(){return{map:{}}},created:function(){return Object(r["a"])(Object(o["a"])().mark((function e(){return Object(o["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()},mounted:function(){var e=this;SGMap.tokenTask.login("8a2d9f94f4ae3df2ba80b2f9df8970e5","1d154b90b347326b9622c510d170e707").then((function(){e.initMap()})).catch((function(e){console.log(e)}))},methods:{initMap:function(){this.map=new SGMap.Map({container:"map",style:"aegis://styles/aegis/Streets-v2",center:[120.06219,30.3602],zoom:16,localIdeographFontFamily:"Microsoft YoHei"}),console.log("init map",this.map)}}}),c=s,d=i("2877"),l=Object(d["a"])(c,a,n,!1,null,null,null);t["a"]=l.exports},"86bc":function(e,t,i){"use strict";i("debc")},9406:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"dashboard-container",style:{backgroundImage:"url("+e.bgSrc+")",backgroundRepeat:"no-repeat",backgroundSize:"100% 100%"}},[e.isShowDashboard?i("div",[i("div",{attrs:{id:"container"}}),e.dashboardList.length>1?i("div",{staticClass:"dashboard_check"},e._l(e.dashboardList,(function(t,a){return i("div",{key:t.objectId+a,staticClass:"screen_check_item",class:t.objectId==e.dashboardId?"screen_select":"screen_unselect",staticStyle:{"font-size":"1em"},on:{click:function(i){return e.handleToCheckout(t)}}},[e._v(" "+e._s(t.title)+" ")])})),0):e._e(),e.vueFlag?i("div",e._l(e.vueComponents,(function(t,a){return i("div",{key:a,staticClass:"vue_component",style:{left:t.x+"px",top:t.y+"px",width:t.width+"px",height:t.height+"px"}},["counter"==t.type&&"all_countervalue"!=t.id?i("topo-card",{style:{width:t.width+"px",height:t.height+"px"},attrs:{comp:t}}):"count"==t.type&&"all_countvalue"==t.id?i("screen-headcounter",{style:{width:t.width+"px",height:t.height+"px"},attrs:{comp:t}}):"count"==t.type?i("screen-headitem",{style:{width:t.width+"px",height:t.height+"px"},attrs:{comp:t}}):"liveboard"==t.type?i("dgiot-aliplayer",{style:{width:t.width+"px",height:t.height+"px"},attrs:{comp:t}}):"line"==t.type?i("screen-line",{style:{width:t.width+"px",height:t.height+"px"},attrs:{comp:t,viewtype:e.viewtype}}):"devicebar"==t.type?i("screen-device-bar",{style:{width:t.width+"px",height:t.height+"px"},attrs:{comp:t,viewtype:e.viewtype}}):"list"==t.type&&"device_list"==t.id?i("screen-device",{style:{width:t.width+"px",height:t.height+"px"},attrs:{comp:t},on:{initScreen:e.initScreen}}):"list"==t.type&&"warning_list"==t.id?i("topo-caltable",{style:{width:t.width+"px",height:t.height+"px"},attrs:{comp:t}}):"list"==t.type&&"warning_list1"==t.id?i("dgiot-notification1",{style:{width:t.width+"px",height:t.height+"px"},attrs:{comp:t}}):"map"==t.type&&"baidumap"==t.id?i("screen-baidumap",{style:{width:t.width+"px",height:t.height+"px"},attrs:{comp:t},on:{initScreen:e.initScreen}}):"map"==t.type&&"sgmap"==t.id?i("screen-sgmap",{style:{width:t.width+"px",height:t.height+"px"},attrs:{comp:t},on:{initScreen:e.initScreen}}):"list"==t.type&&"workorder_list"==t.id?i("work-order",{style:{width:t.width+"px",height:t.height+"px"},attrs:{comp:t}}):"pie"==t.type?i("topo-pie",{style:{width:t.width+"px",height:t.height+"px"},attrs:{comp:t}}):"realtime"==t.type?i("real-time",{style:{width:t.width+"px",height:t.height+"px"},attrs:{comp:t}}):"3d"==t.type&&"3d_fbx"==t.id?i("dgiot-model-fac",{style:{width:t.width+"px",height:t.height+"px"},attrs:{comp:t}}):"konvaimage"==t.type?i("img",{style:{width:t.width+"px",height:t.height+"px"},attrs:{src:t.src.includes("//")?t.src:e.$FileServe+t.src}}):e._e()],1)})),0):e._e(),e.amisFlag?i("div",e._l(e.amisComponents,(function(e,t){return i("amis",{key:t,staticClass:"amis_component",style:{left:e.x+"px",top:e.y+"px",width:e.width+"px",height:e.height+"px"},attrs:{"modal-append-to-body":"",schema:e.viewData,"show-help":!1}})})),1):e._e()]):i("div",[e.shiftShow?i("div",[i("amis",{staticClass:"amis_component",attrs:{"modal-append-to-body":"",schema:e.header.data,"show-help":!1}})],1):e._e()]),e.dialogScreenAmisVisible?i("el-dialog",{attrs:{top:"10vh","append-to-body":!0,width:"600px",visible:e.dialogScreenAmisVisible},on:{"update:visible":function(t){e.dialogScreenAmisVisible=t}}},[i("amis",{attrs:{"modal-append-to-body":"",schema:e.screenAmisData,"show-help":!1}})],1):e._e()],1)},n=[],o=i("c7eb"),r=i("1da1"),s=i("5530"),c=(i("d3b7"),i("159b"),i("14d9"),i("ace4"),i("5cc6"),i("907a"),i("9a8c"),i("a975"),i("735e"),i("c1ac"),i("d139"),i("3a7b"),i("986a"),i("1d02"),i("d5d6"),i("82f8"),i("e91f"),i("60bd"),i("5f96"),i("3280"),i("3fcc"),i("ca91"),i("25a1"),i("cd26"),i("3c5d"),i("2954"),i("649e"),i("219c"),i("170b"),i("b39a"),i("1b3b"),i("3d71"),i("72f7"),i("c6e3"),i("b64b"),i("25f0"),i("e9c4"),i("7db0"),i("caad"),i("2532"),i("b0c0"),i("1b8a")),d=i.n(c),l=i("264a"),u=i("aa38"),h=i("32db"),p=i("c7d9"),m=i("ae53"),A=i("fca4"),f=i("ad0f"),g=i("11ac"),b=i("766c"),v=i("e6a3"),y=i("a458"),w=i("c006"),I=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticStyle:{width:"100%",height:"100%","background-color":"#000"}},[i("model-gltf",{ref:"model",attrs:{id:"model","controls-options":{enableRotate:!0,enableZoom:!0,enablePan:!0},rotation:e.rotation,src:"/dgiot_file/3d/3dpic.glb"},on:{"on-click":e.handleClick,"on-load":e.onLoad,"on-mousemove":e.onMouseMove}})],1)},x=[],C=i("e360"),k=i("ed08"),S={name:"RealTime",props:{comp:{type:Object,default:function(){return{type:"videolive",width:400,hieght:72}}}},components:{ModelObj:C["ModelObj"],ModelThree:C["ModelThree"],modelFbx:C["modelFbx"],ModelCollada:C["ModelCollada"],ModelStl:C["ModelStl"],ModelPly:C["ModelPly"],ModelGltf:C["ModelGltf"]},data:function(){return{rotation:{x:0,y:0,z:0}}},mounted:function(){console.log("这是3d组件")},methods:{onLoad:function(){this.rotate()},rotate:function(){this.rotation.y-=.01,requestAnimationFrame(this.rotate)},handleClick:function(e){window.click=e,console.log("点击了",e,this.$refs.model.renderer.getContext("webgl2")),this.modelRef.material.color.setStyle("#13ce66"),window.renderer=this.$refs.model.renderer},onMouseMove:function(e){if(e)return this.modelRef||(this.modelRef=e.object),void(window.modelRef=this.modelRef)},handleOnload:function(){}},destroyed:function(){clearInterval(this.timer)}},E=S,B=(i("4a1d"),i("2877")),j=Object(B["a"])(E,I,x,!1,null,"6bcccc8b",null),M=j.exports,O=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{ref:"container",staticStyle:{width:"100%",height:"100%"}},[i("div",{staticStyle:{"font-size":"14px",color:"#fff",position:"absolute"}},e._l(e.scenes,(function(t,a){return i("span",{key:a,staticStyle:{display:"inline-block","margin-right":"20px",padding:"2px 4px",border:"1px solid #fff","border-radius":"2px",cursor:"pointer"},style:{"background-color":a==e.index?"#56a0e3":""},on:{click:function(t){return e.handleSwitchScene(a)}}},[e._v(e._s(t.name))])})),0),e._l(e.scenes,(function(t,a){return i("h1",{key:a,staticStyle:{"font-size":"28px",color:"#fff",position:"absolute"},style:{display:a==e.index?"":"none",top:t.top,left:t.left}},[e._v(" "+e._s(t.text)+" ")])}))],2)},Q=[],D=i("5a89"),R=i("cffa"),T=i("ef20"),G=i("4721"),$=i("8710"),L=i("34ad"),F=i("0ca5"),K=null,U=null,z=null,P=null,Z=null,N=(new D["AnimationMixer"],new D["Clock"]),J=new T["a"],V={props:{comp:{type:Object,default:function(){return{type:"videolive",width:400,hieght:72}}}},data:function(){return{model:{yuanzhu:null,house:null,fbx:null,floor:null},animations:{},rotation:"",timer:"",index:0,isAnimate:!1,scenes:[],timeLine1:"",timeLine2:""}},mounted:function(){console.log("111111"),this.init(),this.animate(),this.addmeth()},methods:{init:function(){var e=this,t=this.$refs.container;K=new D["Scene"];var i=new D["AxesHelper"](250);K.add(i);var a=new D["BoxGeometry"](100,100,100),n=[this.loadtexture("https://vkceyugu.cdn.bspapp.com/VKCEYUGU-7184a2f2-3b0b-407a-adc8-4d450f35c1e7/f3790b7e-485e-4ceb-bda7-7e3b44462357.jpg"),this.loadtexture("https://vkceyugu.cdn.bspapp.com/VKCEYUGU-7184a2f2-3b0b-407a-adc8-4d450f35c1e7/f3790b7e-485e-4ceb-bda7-7e3b44462357.jpg"),this.loadtexture("https://vkceyugu.cdn.bspapp.com/VKCEYUGU-7184a2f2-3b0b-407a-adc8-4d450f35c1e7/f3790b7e-485e-4ceb-bda7-7e3b44462357.jpg"),this.loadtexture("https://vkceyugu.cdn.bspapp.com/VKCEYUGU-7184a2f2-3b0b-407a-adc8-4d450f35c1e7/f3790b7e-485e-4ceb-bda7-7e3b44462357.jpg"),this.loadtexture("https://vkceyugu.cdn.bspapp.com/VKCEYUGU-7184a2f2-3b0b-407a-adc8-4d450f35c1e7/f3790b7e-485e-4ceb-bda7-7e3b44462357.jpg"),this.loadtexture("https://vkceyugu.cdn.bspapp.com/VKCEYUGU-7184a2f2-3b0b-407a-adc8-4d450f35c1e7/f3790b7e-485e-4ceb-bda7-7e3b44462357.jpg")],o=[];n.forEach((function(e){var t=new D["MeshDepthMaterial"](e);o.push(t)}));var r=new D["Mesh"](a,o);r.position.set(200,200,0),K.add(r);var s=new D["SphereGeometry"](60,60,60),c=new D["MeshDepthMaterial"](n[0]);Z=new D["Mesh"](s,c),Z.position.set(300,350,100),K.add(Z);var d=new D["CylinderGeometry"](20,20,180,200);Z=new D["Mesh"](d,c),Z.position.set(100,100,100),K.add(Z);var l=new D["Group"];l.position.set(300,150,90);for(var u=80,h=[],p=0;p<3;p++){var m=new D["SphereGeometry"](8,32,32),A=new D["MeshStandardMaterial"]({color:16777215,emissive:16777215,emissiiveIntensity:10}),f=new D["Mesh"](m,A);h.push(f),f.position.set(u*Math.cos(2*p*Math.PI/3),Math.cos(2*p*Math.PI/3),u*Math.sin(2*p*Math.PI/3));var g=new D["PointLight"](16777215,2);f.add(g),l.add(f)}K.add(l);var b={angle:0};R["a"].to(b,{angle:2*Math.PI,duration:10,repeat:-1,ease:"linear",onUpdate:function(){l.rotation.y=b.angle,h.forEach((function(e,t){e.position.set(u*Math.cos(2*t*Math.PI/3),Math.cos(2*t*Math.PI/3+5*b.angle)+5,u*Math.sin(2*t*Math.PI/3))}))}});var v=document.createElement("canvas");v.width=600,v.height=100;var y=v.getContext("2d");y.fillStyle="#ffffff",y.font="100px 黑体",y.lineWidth=4,y.fillText("精灵中文字体",4,104);var w=new D["Texture"](v);w.needsUpdate=!0;var I=new D["SpriteMaterial"]({map:w}),x=new D["Sprite"](I);x.scale.set(50,25,75),x.position.set(200,200,200),K.add(x);var C=new F["a"];C.setDecoderPath("./draco/gltf/");var k=new L["a"];k.setDRACOLoader(C),k.load("/dgiot_file/3d/LittlestTokyo.glb",(function(t){var i=t.scene;i.position.set(1,100,0),console.log("这是模型LittlestTokyo",t),i.scale.x=.8,i.scale.y=.8,i.scale.z=.8,i.traverse((function(e){"Plane"===e.name&&e.visiable,e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0)})),e.model.house=i,K.add(i),e.animations["house"]=new D["AnimationMixer"](i),e.animations["house"].clipAction(t.animations[0]).play(),e.animate()}));var S=new $["a"];S.load("/dgiot_file/3d/dancing.fbx",(function(t){console.log("这是模型1",t,t.animations,t.animations[0].name),e.model.fbx=t,e.model.fbx.position.set(200,-60,100),e.model.fbx.scale.set(.7,.7,.7),K.add(e.model.fbx)}),void 0,(function(e){console.error(e)})),S.load("/dgiot_file/3d/3ddemo/floor.fbx",(function(t){console.log("这是模型2",t),e.model.floor=t,e.model.floor.position.set(-300,-60,-100),e.model.floor.scale.set(.1,.1,.1),K.add(e.model.floor)}),void 0,(function(e){console.error(e)}));var E=new D["PointLight"](15921906,1);E.position.set(0,0,0),E.castShadow=!0,K.add(E);var B=t.clientWidth,_=t.clientHeight,j=B/_,M=300;U=new D["OrthographicCamera"](-M*j,M*j,M,-M,1,1e3),U.position.set(200,300,500),U.lookAt(K.position),z=new D["WebGLRenderer"]({antialias:!0}),z.setSize(t.clientWidth,t.clientHeight),z.shadowMap.enabled=!0,z.physicallyCorrectLights=!1,z.setClearColor(3355443),P=new G["a"](U,z.domElement),P.target.set(100,0,0),P.maxPolarAngle=.5*Math.PI,P.minDistance=0,P.maxDistance=2e3,t.appendChild(z.domElement),this.scenes=[{id:"dada",realdata:[{name:"温度",value:"15"}],name:"场景1",text:"Hello,Threejs",top:"10%",left:"60%",callback:function(){e.translateCamara(new D["Vector3"](200,300,500),new D["Vector3"](100,0,0))}},{name:"场景2",text:"3D世界环境欢迎你",top:"10%",left:"80%",callback:function(){e.translateCamara(new D["Vector3"](180,300,200),new D["Vector3"](100,0,0))}},{name:"场景3",text:"探寻世界之秘",top:"40%",left:"30%",callback:function(){e.translateCamara(new D["Vector3"](100,30,500),new D["Vector3"](5,2,0))}},{name:"场景4",text:"文字标签最常用的方法",top:"60%",left:"60%",callback:function(){e.translateCamara(new D["Vector3"](100,20,0),new D["Vector3"](5,2,0))}},{name:"场景5",text:"保证能够显示在3D场景之上",top:"20%",left:"20%",callback:function(){e.translateCamara(new D["Vector3"](100,300,50),new D["Vector3"](100,200,0))}}],this.timeLine1=R["a"].timeline(),this.timeLine2=R["a"].timeline()},loadtexture:function(e){var t=new D["TextureLoader"],i=t.load(e),a=new D["MeshBasicMaterial"]({map:i,side:D["DoubleSide"]});return a},handleSwitchScene:function(e){this.index=e,this.scenes[this.index].callback()},translateCamara:function(e,t){this.timeLine1.to(U.position,{x:e.x,y:e.y,z:e.z,duration:1,ease:"power2.inOut"}),this.timeLine2.to(P.target,{x:t.x,y:t.y,z:t.z,duration:1,ease:"power2.inOut"})},startAnimation:function(e,t,i){var a=new D["AnimationMixer"](e),n=D["AnimationClip"].findByName(t,i);if(console.log("clip",n),n){var o=a.clipAction(n);o.play()}return a},animate:function(){P.update();var e=N.getDelta();for(var t in this.animations)this.animations[t].update(e);TWEEN.update(),requestAnimationFrame(this.animate),J.update(),z.render(K,U)},mouseDown:function(e){this.isclick={clientX:e.clientX,clientY:e.clientY},console.log(this.model.fbx),this.animations["fbx"]?delete this.animations["fbx"]:this.animations["fbx"]=this.startAnimation(this.model.fbx,this.model.fbx.animations,this.model.fbx.animations[0].name)},mouseWheel:function(e){var t=this;console.log("e.deltaY ",e.deltaY),this.isAnimate||(this.isAnimate=!0,e.deltaY>0&&(this.index++,this.index>this.scenes.length-1&&(this.index=0)),this.scenes[this.index].callback(),setTimeout((function(){t.isAnimate=!1}),1e3))},addmeth:function(){window.addEventListener("resize",this.changeSize,!1),this.$refs.container.addEventListener("mousedown",this.mouseDown,!1),this.$refs.container.addEventListener("wheel",this.mouseWheel,!1),window.addEventListener("mousemove",this.mouseMove,!1),window.addEventListener("mouseup",this.mouseUp,!1)}}},Y=V,W=(i("86bc"),Object(B["a"])(Y,O,Q,!1,null,"84cdbfc0",null)),H=W.exports,q=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{ref:"container",staticStyle:{width:"100%",height:"100%","background-color":"#000"}})},X=[];i("53f9");var ee=null,te=null,ie=null,ae=null,ne=null,oe=(new D["Clock"],{props:{comp:{type:Object,default:function(){return{type:"videolive",width:400,hieght:72}}}},data:function(){return{model:{yuanzhu:null,fbx:null},rotation:"",timer:""}},mounted:function(){console.log("111111"),this.init(),this.animate(),this.addmeth()},methods:{init:function(){var e=this.$refs.container;ee=new D["Scene"];var t=new D["AxesHelper"](250);ee.add(t);var i=new D["MeshLambertMaterial"]({color:1947871,opacity:.3,transparent:!1});ee.add(ne);var a=new D["BoxGeometry"](100,100,100);ne=new D["Mesh"](a,i),ne.position.set(100,100,100),ee.add(ne);var n=new D["PointLight"](15921906);n.position.set(100,200,500),ee.add(n);var o=new D["AmbientLight"](4210752);ee.add(o);var r=e.clientWidth,s=e.clientHeight,c=r/s,d=300;te=new D["OrthographicCamera"](-d*c,d*c,d,-d,1,1e3),te.updateProjectionMatrix(),te.position.set(100,200,500),te.lookAt(ee.position),ie=new D["WebGLRenderer"]({antialias:!0}),ie.setSize(e.clientWidth,e.clientHeight),ie.setClearColor(16777215),e.appendChild(ie.domElement),ae=new G["a"](te,ie.domElement),ae.enableDamping=!0,ae.maxPolarAngle=.5*Math.PI,ae.minDistance=0,ae.maxDistance=2e3;var l=new F["a"];l.setDecoderPath("./draco/gltf/");var u=new L["a"];u.setDRACOLoader(l),u.load("/dgiot_file/3d/LittlestTokyo.glb",(function(e){var t=e.scene;t.position.set(1,1,0),ee.add(t)}))},animate:function(){ae.update(),TWEEN.update(),requestAnimationFrame(this.animate),ie.render(ee,te)},mouseDown:function(e){var t=this;if(console.log("点击",this.yuanzhu,e),this.isclick={clientX:e.clientX,clientY:e.clientY},this.model.yuanzhu){var i=["fbx","yuanzhu"],a=Math.round(Math.random());console.log("this.sss",this.timer),this.timer?(clearInterval(this.timer),this.timer=""):this.timer=setInterval((function(){t.model.fbx.rotation.y-=.1,t.model.fbx.position.setX(t.model.fbx.position.x+Math.random()-.1),t.model.fbx.position.setY(t.model.fbx.position.y+Math.random()-.1)}),100),this.model[i[a]].position.set((Math.random()-.5)*Math.random()*500,200*Math.random(),100*Math.random()),this.model["yuanzhu"].material.color.setStyle("#ff0000")}else{var n=new D["MeshLambertMaterial"]({color:1947871,opacity:.3,transparent:!0}),o=new D["CylinderGeometry"](20,40,180,200);this.model.yuanzhu=new D["Mesh"](o,n),this.model.yuanzhu.position.set((Math.random()-.5)*Math.random()*500,200*Math.random(),100*Math.random()),ee.add(this.model.yuanzhu)}},addmeth:function(){window.addEventListener("resize",this.changeSize,!1),this.$refs.container.addEventListener("mousedown",this.mouseDown,!1),window.addEventListener("mousemove",this.mouseMove,!1),window.addEventListener("mouseup",this.mouseUp,!1)}}}),re=oe,se=(i("1d10"),Object(B["a"])(re,q,X,!1,null,"f8f13256",null)),ce=se.exports,de=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{ref:"container",staticStyle:{width:"100%",height:"100%"}},[i("div",{staticStyle:{"font-size":"14px",color:"#fff",position:"absolute"}},e._l(e.scenes,(function(t,a){return i("span",{key:a,staticStyle:{display:"inline-block","margin-right":"5px",padding:"5px 16px","border-radius":"2px",cursor:"pointer","background-color":"rgb(35, 78, 98, 0.5)"},style:{color:a==e.index?"#04e9eb":""},on:{click:function(t){return e.handleSwitchScene(a)}}},[e._v(e._s(t.name))])})),0),e._l(e.scenes,(function(t,a){return i("div",{key:a,staticStyle:{"font-size":"20px",color:"#fff",position:"absolute"},style:{display:a==e.index?"":"none",top:t.top,left:t.left,width:t.width,height:t.height}},e._l(t.realdata,(function(t,a){return i("div",{key:a,staticStyle:{display:"flex"}},[i("div",{staticStyle:{flex:"1"}},[e._v(e._s(t.text)+":")]),i("div",{staticStyle:{flex:"2"}},[e._v(e._s(t.value))])])})),0)}))],2)},le=[],ue=(i("a9e3"),i("b680"),null),he=null,pe=null,me=null,Ae=null,fe=(new D["AnimationMixer"],new D["Clock"]),ge=new T["a"],be={props:{comp:{type:Object,default:function(){return{type:"videolive",width:400,hieght:72}}}},data:function(){return{model:{yuanzhu:null,house:null,fbx:null,floor:null},animations:{},rotation:"",timer:"",index:0,isAnimate:!1,scenes:[],timeLine1:"",timeLine2:""}},mounted:function(){console.log("111111"),this.init(),this.animate(),this.addmeth()},beforeDestroy:function(){clearInterval(this.timer)},methods:{init:function(){var e=this;this.scenes=[{id:"finished",realdata:[{name:"temp",text:"温度",value:"15℃"},{name:"humid",text:"湿度",value:"50%"}],name:"仓储区",width:"30%",height:"20%",top:"20%",left:"70%",callback:function(){e.translateCamara(new D["Vector3"](-300,300,-800),new D["Vector3"](0,0,0))}},{id:"live",name:"居住区",realdata:[{name:"people",text:"人员数",value:"20"},{name:"elec",text:"用电量",value:"400KW·h"},{name:"water",text:"用水量",value:"300t"}],top:"24%",left:"60%",width:"30%",height:"20%",callback:function(){e.translateCamara(new D["Vector3"](500,200,400),new D["Vector3"](400,100,150))}}];var t=this.$refs.container;ue=new D["Scene"];var i=[this.loadtexture("/dgiot_file/3d/maps/fac1.png"),this.loadtexture("/dgiot_file/3d/maps/fac2.png"),this.loadtexture("/dgiot_file/3d/maps/fac_grass.jpg"),this.loadtexture("/dgiot_file/3d/maps/fac1.png"),this.loadtexture("/dgiot_file/3d/maps/fac1.png"),this.loadtexture("/dgiot_file/3d/maps/fac1.png")],a=new D["BoxGeometry"](300,2,300),n=[{},{},new D["MeshDepthMaterial"](i[2]),{},{},{}],o=new D["Mesh"](a,n);o.position.set(-100,1,-100),ue.add(o);var r=[{x:-180,y:50,z:-180},{x:-180,y:50,z:-50},{x:-50,y:50,z:-180},{x:-50,y:50,z:-50}];r.forEach((function(e){var t=new D["CylinderGeometry"](50,50,100,100);Ae=new D["Mesh"](t,i[0]),Ae.position.set(e.x,e.y,e.z),ue.add(Ae)}));var s=new F["a"];s.setDecoderPath("./draco/gltf/");var c=new L["a"];c.setDRACOLoader(s),c.load("/dgiot_file/3d/LittlestTokyo.glb",(function(t){var i=t.scene;i.position.set(400,100,150),console.log("这是模型LittlestTokyo",t),i.scale.x=.5,i.scale.y=.5,i.scale.z=.5,i.traverse((function(e){"Plane"===e.name&&e.visiable,e.isMesh&&(e.receiveShadow=!0)})),e.model.house=i,ue.add(i),e.animations["house"]=new D["AnimationMixer"](i),e.animations["house"].clipAction(t.animations[0]).play(),e.animate()}));var d=new $["a"];d.load("/dgiot_file/3d/3ddemo/floor.fbx",(function(t){console.log("这是模型2",t),e.model.floor=t,e.model.floor.position.set(-300,0,-100),e.model.floor.scale.set(.15,.15,.15),ue.add(e.model.floor)}),void 0,(function(e){console.error(e)}));var l=new D["PointLight"](16777215,5);l.position.set(400,500,400),ue.add(l);var u=t.clientWidth,h=t.clientHeight,p=u/h,m=300;he=new D["OrthographicCamera"](-m*p,m*p,m,-m,.1,1e4),he.position.set(-300,300,-800),he.lookAt(ue.position),pe=new D["WebGLRenderer"]({antialias:!0}),pe.setSize(t.clientWidth,t.clientHeight),pe.shadowMap.enabled=!0,pe.setClearColor(8619912),me=new G["a"](he,pe.domElement),me.target.set(0,0,0),me.maxPolarAngle=.5*Math.PI,me.minDistance=0,me.maxDistance=5e3,t.appendChild(pe.domElement),this.timeLine1=R["a"].timeline(),this.timeLine2=R["a"].timeline(),this.timer=setInterval((function(){var t=["temp","humid"];e.scenes.forEach((function(e){if("finished"==e.id){var i=t[Math.floor(2*Math.random())],a="";a="temp"==i?Number(Math.random().toFixed(2))+15+"℃":Number(Math.random().toFixed(2))+50+"%",e.realdata.forEach((function(e){e.name==i&&(e.value=a)}))}}))}),3e3)},loadtexture:function(e){var t=new D["TextureLoader"],i=t.load(e),a=new D["MeshBasicMaterial"]({map:i,side:D["DoubleSide"]});return a},handleSwitchScene:function(e){this.index=e,this.scenes[this.index].callback()},translateCamara:function(e,t){this.timeLine1.to(he.position,{x:e.x,y:e.y,z:e.z,duration:1,ease:"power2.inOut"}),this.timeLine2.to(me.target,{x:t.x,y:t.y,z:t.z,duration:1,ease:"power2.inOut"})},startAnimation:function(e,t,i){var a=new D["AnimationMixer"](e),n=D["AnimationClip"].findByName(t,i);if(console.log("clip",n),n){var o=a.clipAction(n);o.play()}return a},animate:function(){me.update();var e=fe.getDelta();for(var t in this.animations)this.animations[t].update(e);TWEEN.update(),requestAnimationFrame(this.animate),ge.update(),pe.render(ue,he)},mouseDown:function(e){this.isclick={clientX:e.clientX,clientY:e.clientY}},mouseWheel:function(e){console.log("e.deltaY ",e.deltaY)},addmeth:function(){window.addEventListener("resize",this.changeSize,!1),this.$refs.container.addEventListener("mousedown",this.mouseDown,!1),this.$refs.container.addEventListener("wheel",this.mouseWheel,!1),window.addEventListener("mousemove",this.mouseMove,!1),window.addEventListener("mouseup",this.mouseUp,!1)}}},ve=be,ye=(i("c766"),Object(B["a"])(ve,de,le,!1,null,"11b4a1a8",null)),we=ye.exports,Ie=i("b34f"),xe=i("624b"),Ce=i("2f62"),ke=i("a598"),Se=i("8ba7"),Ee=i("b775");function Be(e){return Object(Ee["a"])({url:"/relation",method:"get",headers:{accept:"application/json","Content-Type":"application/json"},params:e})}var _e=i("39c4"),je=i("5f87"),Me={name:"Dashboard",components:{amis:ke["a"],TopoCard:u["a"],TopoPie:h["a"],TopoCaltable:p["a"],ScreenDevice:m["a"],ScreenRealcard:f["a"],WorkOrder:A["a"],ScreenBaidumap:g["a"],ScreenSgmap:b["a"],ScreenHeaditem:w["a"],DgiotAliplayer:l["a"],ScreenLine:v["a"],ScreenDeviceBar:y["a"],RealTime:Ie["a"],DgiotNotification1:xe["a"],DgiotModelFbx:M,DgiotModelDemo:H,DgiotModelDemo3:ce,DgiotModelFac:we},data:function(){return{viewtype:"Dashboard",json:{},layer:"",stage:"",bgSrc:d.a,vueComponents:[],amisComponents:[],vueFlag:!1,amisFlag:!1,viewData:{},queryParams:[],dashboardId:"",dashboardList:[],isPC:!0,clientWidth:1920,shiftShow:!1,isShowDashboard:!0,dialogScreenAmisVisible:!1,screenAmisData:{}}},computed:Object(s["a"])({},Object(Ce["b"])(["name"])),created:function(){this.isPC=Object(k["b"])(),localStorage.setItem("isPC",this.isPC)},mounted:function(){var e=this;return Object(r["a"])(Object(o["a"])().mark((function t(){var i,a,n,r,s,c,d,l,u;return Object(o["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.isPC="true"==localStorage.getItem("isPC"),e.isShowDashboard=document.body.clientWidth>500,localStorage.setItem("dgiottopbar","[]"),e.$store.dispatch("settings/changeSetting",{key:"treeFlag",value:!1}),i=window.innerWidth,a=window.innerHeight,n=localStorage.getItem("deptId"),t.next=9,Be({destClass:"_Role",destId:n,destField:"views",srcClass:"View"});case 9:if(r=t.sent,s=r.results,c=void 0===s?[]:s,!_.isEmpty(c)){t.next=17;break}return e.$message("暂未配置组态大屏"),t.abrupt("return",!1);case 17:d=[],l=[],u=!0,c.forEach((function(t){"Dashboard"==t.type&&u?(d.push(t),u=!1,e.viewtype=t.type,e.json=t.data.konva.Stage,console.log("json",e.json),e.dashboardId=t.objectId):"Dashboard"==t.type?d.push(t):"Amis"==t.flag&&t.title.indexOf("移动端")<0?l.push(t):t.title.indexOf("移动端")>=0&&(e.header=t,console.log(e.header),e.shiftShow=!0)})),e.dashboardList=d,e.queryData();case 23:e.layer=Konva.Node.create(e.json,"container").findOne("Layer"),e.stage=new Konva.Stage({container:"container",width:i,height:a}),e.stage.add(e.layer),e.$dgiotBus.$off("$dg/user/allrealdata"),e.$dgiotBus.$on("$dg/user/allrealdata",(function(t){var i=String.fromCharCode.apply(null,new Uint8Array(t)),a=JSON.parse(Base64.decode(i));console.log("allrealdata",a);var n=0,o=0,r=0;a.forEach((function(t){var i=t.number+t.unit,a="green";t.hasOwnProperty("color")&&(a=t.color,"red"===a?n+=1:"green"===a?o+=1:"yellow"===a&&(r+=1));e.putNode(e.stage,t.label,i,a)})),e.putNode(e.stage,"status_red_text",n.toString(),"red"),e.putNode(e.stage,"status_green_text",o.toString(),"green"),e.putNode(e.stage,"status_yellow_text",r.toString(),"yellow");var s=Object(je["a"])(),c="$dg/user/dashboard/".concat(s,"/ack"),d={ack:"heartbeat"};e.$dgiotBus.$emit("MqttPublish",{pubTopic:c,message:JSON.stringify(d),qs:0,status:!1})})),e.handleInitKonva(),e.$dgiotBus.$off("$dg/user/amisdata"),e.$dgiotBus.$on("$dg/user/amisdata",(function(t){var i=String.fromCharCode.apply(null,new Uint8Array(t));console.log("amisdata",i);var a=JSON.parse(Base64.decode(i));e.amisComponents=a})),window.onresize=function(){return function(){e.layer=Konva.Node.create(e.json,"container").findOne("Layer"),e.stage=new Konva.Stage({container:"container",width:i,height:a}),e.stage.add(e.layer),e.handleInitKonva()}()};case 32:case"end":return t.stop()}}),t)})))()},destroyed:function(){if(this.clientWidth>736){var e=document.getElementsByTagName("html")[0];e.style.fontSize="16px"}},methods:{putNode:function(e,t,i,a){e.find("#".concat(t)).forEach((function(e){e.setAttr("text",i),e.setAttr("fill","black")}));var n="#".concat(t)+"_tag";e.find(n).forEach((function(e){e.setAttr("fill",a)})),this.layer.batchDraw()},handleToCheckout:function(e){if(e.objectId!=this.dashboardId){var t=window.innerWidth,i=window.innerHeight;this.json=e.data.konva.Stage,console.log("json",this.json),this.vueComponents=[],this.vueFlag=!1,this.dashboardId=e.objectId,this.queryData(),this.layer=Konva.Node.create(this.json,"container").findOne("Layer"),this.stage=new Konva.Stage({container:"container",width:t,height:i}),this.stage.add(this.layer),this.handleInitKonva()}},handleInitKonva:function(){var e=this;return Object(r["a"])(Object(o["a"])().mark((function t(){var i,a,n;return Object(o["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.clientWidth=document.body.clientWidth,e.clientWidth>500&&(i=document.getElementsByTagName("html")[0],i.style.fontSize=document.body.clientWidth/1940*16+"px"),a=[],n=[],e.amisFlag=!1,e.stage.find("Label").forEach((function(t){e.initSize(t),t.setAttrs({draggable:!1})})),e.stage.find("Tag").forEach((function(t){t.setAttrs({draggable:!1}),t=e.initScale(t)})),e.stage.find("Text").forEach((function(t){t.setAttrs({draggable:!1}),t.on("touchend",function(){var i=Object(r["a"])(Object(o["a"])().mark((function i(a){var n,r,s;return Object(o["a"])().wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(console.error("touchend",t),!t.attrs.bind_amis){i.next=11;break}return localStorage.setItem("parse_objectid",t.attrs.screen_deviceid),localStorage.setItem("parse_productid",t.attrs.screen_productid),n={viewid:t.attrs.amis_id},r={render:{screen_deviceid:t.attrs.screen_deviceid,screen_productid:t.attrs.screen_productid}},i.next=8,Object(Se["c"])(n,r);case 8:s=i.sent,e.screenAmisData=s.data,e.dialogScreenAmisVisible=!0;case 11:case"end":return i.stop()}}),i)})));return function(e){return i.apply(this,arguments)}}()),t.on("click",function(){var i=Object(r["a"])(Object(o["a"])().mark((function i(a){var n,r,s;return Object(o["a"])().wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(console.error("click",t),!t.attrs.bind_amis){i.next=11;break}return localStorage.setItem("parse_objectid",t.attrs.screen_deviceid),localStorage.setItem("parse_productid",t.attrs.screen_productid),n={viewid:t.attrs.amis_id},r={render:{screen_deviceid:t.attrs.screen_deviceid,screen_productid:t.attrs.screen_productid}},i.next=8,Object(Se["c"])(n,r);case 8:s=i.sent,e.screenAmisData=s.data,e.dialogScreenAmisVisible=!0;case 11:case"end":return i.stop()}}),i)})));return function(e){return i.apply(this,arguments)}}()),t=e.initScale(t)})),e.stage.find("Image").forEach((function(t){if(e.initSize(t),"bg"===t.attrs.id&&(e.bgSrc=t.attrs.src.includes("//")?t.attrs.src:e.$FileServe+t.attrs.src),"konvaimage"===t.attrs.type||"vuecomponent"===t.attrs.name){var i=t.attrs;i.type,a.push(i)}else if("amiscomponent"==t.attrs.name){var o=t.attrs;n.push(o)}else if(t.attrs.id.indexOf("不")<0&&t.attrs.id.indexOf("bg")<0){var r=new Image;t.setAttrs({image:r}),r.src=t.attrs.src.includes("//")?t.attrs.src:e.$FileServe+t.attrs.src}})),e.stage.find("Rect").forEach((function(t){if(e.initSize(t),"vuecomponent"===t.attrs.name){var i=t.attrs;a.push(i)}else if("amiscomponent"===t.attrs.name){var o=t.attrs;n.push(o)}})),e.vueComponents=a,e.vueFlag=!0,e.amisFlag=!0;case 13:case"end":return t.stop()}}),t)})))()},initSize:function(e){var t=document.body.clientWidth/1940;this.isPC?e.setAttrs({draggable:!1,x:e.attrs.x*t,y:e.attrs.y*t,width:e.attrs.width*t,height:e.attrs.height*t,fontSize:e.attrs.fontSize*t}):e.setAttrs({draggable:!1,x:e.attrs.x*document.body.clientWidth/1920,y:e.attrs.y*document.body.clientHeight/960,width:e.attrs.width*document.body.clientWidth/1920,height:e.attrs.height*document.body.clientHeight/960,fontSize:e.attrs.fontSize*t})},initScale:function(e){var t=document.body.clientWidth/1940;return this.isPC?(e.attrs.fontSize=e.attrs.fontSize*t,e.attrs.x=e.attrs.x*t,e.attrs.width=e.attrs.width*t,e.attrs.y=e.attrs.y*t,e.attrs.height=e.attrs.height*t):(e.attrs.fontSize=e.attrs.fontSize*t,e.attrs.x=e.attrs.x*document.body.clientWidth/1920,e.attrs.width=e.attrs.width*document.body.clientWidth/1920,e.attrs.y=e.attrs.y*document.body.clientHeight/960,e.attrs.height=e.attrs.height*document.body.clientHeight/960),e},initScreen:function(){var e=this;return Object(r["a"])(Object(o["a"])().mark((function t(){var i;return Object(o["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return i=e.dashboardId,t.next=3,Object(_e["a"])(i,{});case 3:case"end":return t.stop()}}),t)})))()},queryData:function(){var e=this;return Object(r["a"])(Object(o["a"])().mark((function t(){var i,a,n,s;return Object(o["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(_e["b"])("Dashboard");case 2:i=t.sent,a=i.dashboard,n=void 0===a?{}:a,e.queryParams=n,s=e.dashboardId,setTimeout(Object(r["a"])(Object(o["a"])().mark((function e(){return Object(o["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(_e["a"])(s,{});case 2:case"end":return e.stop()}}),e)}))),2e3);case 8:case"end":return t.stop()}}),t)})))()}}},Oe=Me,Qe=(i("1df5"),i("f8d7"),Object(B["a"])(Oe,a,n,!1,null,"75135778",null));t["default"]=Qe.exports},a13d:function(e,t,i){},a517:function(e,t,i){},aa38:function(e,t,i){"use strict";var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"topoCard",style:{width:e.comp.width+"px",height:e.comp.height+"px"}},[i("div",{staticClass:"card_content"},[i("div",{staticStyle:{"font-size":"1.25em","text-shadow":"1px 2px 0.5px #000"}},[i("span",{staticStyle:{"font-weight":"bold"}},[e._v(e._s(e.label)+": ")]),i("span",{staticStyle:{color:"#efdb64"}},[e._v(e._s(e.value))])])])])},n=[],o=i("5530"),r=(i("99af"),i("ace4"),i("d3b7"),i("5cc6"),i("907a"),i("9a8c"),i("a975"),i("735e"),i("c1ac"),i("d139"),i("3a7b"),i("986a"),i("1d02"),i("d5d6"),i("82f8"),i("e91f"),i("60bd"),i("5f96"),i("3280"),i("3fcc"),i("ca91"),i("25a1"),i("cd26"),i("3c5d"),i("2954"),i("649e"),i("219c"),i("170b"),i("b39a"),i("1b3b"),i("3d71"),i("72f7"),i("c6e3"),i("b64b"),i("e9c4"),i("e762")),s=i("2f62"),c=i("5f87"),d={name:"TopoCard",props:{comp:{type:Object,default:function(){return{type:"line",width:262,hieght:72}}}},computed:Object(o["a"])({},Object(s["b"])(["_product_count","_dev_count","_dev_online_count","_dev_off_count"])),data:function(){return{value:0,topic:"",label:""}},created:function(){},mounted:function(){var e=this;this.label=this.comp.text,this.topic="/".concat(this.comp.type,"/").concat(this.comp.id,"/report"),this.$dgiotBus.$off(this.topic),this.$dgiotBus.$on(this.topic,(function(t){var i=String.fromCharCode.apply(null,new Uint8Array(t)),a=JSON.parse(r["a"].decode(i));console.log(e.comp.type,"接收到了数据=>",a);var n=Object(c["a"])(),o="$dg/user/dashboard/".concat(n,"/ack"),s={ack:"heartbeat"};e.$dgiotBus.$emit("MqttPublish",{pubTopic:o,message:JSON.stringify(s),qs:0,status:!1}),e.text=a.lable,e.value=a.value}))},destroyed:function(){this.$dgiotBus.$off(this.topic)}},l=d,u=(i("d03f"),i("2877")),h=Object(u["a"])(l,a,n,!1,null,"7906aafa",null);t["a"]=h.exports},b34f:function(e,t,i){"use strict";var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"realtime",style:{width:"100%",height:"100%"}},[e._v(" "+e._s(e.nowTime)+" ")])},n=[],o=i("ed08"),r={name:"RealTime",data:function(){return{timer:"",nowTime:""}},mounted:function(){var e=this;this.timer=setInterval((function(){e.datetime()}),1e3)},methods:{datetime:function(){this.nowTime=Object(o["a"])()}},destroyed:function(){clearInterval(this.timer)}},s=r,c=(i("5335"),i("2877")),d=Object(c["a"])(s,a,n,!1,null,"3d9d6c7c",null);t["a"]=d.exports},c006:function(e,t,i){"use strict";var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"screenheaditem",style:{width:"100%",height:"100%"}},[i("div",{staticClass:"count_item",style:{color:e.comp.color||"#fff"},on:{click:e.handleTo}},[i("div",{staticClass:"count_item_head"},[i("div",{staticClass:"count_item_head_left"},[i("div",{staticStyle:{"font-size":"1.5em"}},[e._v(e._s(e.item.name))]),i("div",{staticStyle:{"font-size":"5em"}},[e._v(e._s(e.item.number))])]),i("div",{staticClass:"count_item_head_right"},[i("el-progress",{attrs:{color:e.comp.color||"#409eff",type:"circle","stroke-width":10,percentage:e.item.percent}})],1)]),i("div",{staticClass:"count_item_foot"},[i("div",{staticClass:"count_item_foot_left"},[i("div",{staticStyle:{width:"100%"}},[i("span",{staticClass:"circle success"}),e._v(" "),i("span",[e._v(e._s(e.item.finename))])]),i("div",[e._v(e._s(e.item.finenumber))])]),i("div",{staticClass:"count_item_foot_center"}),i("div",{staticClass:"count_item_foot_right"},[i("div",{staticStyle:{width:"100%"}},[i("span",{staticClass:"circle warning"}),e._v(" "),i("span",[e._v(e._s(e.item.badname))])]),i("div",[e._v(e._s(e.item.badnumber))])])])])])},n=[],o=i("c7eb"),r=i("1da1"),s=(i("b0c0"),i("14d9"),i("d3b7"),i("159b"),i("a9e3"),i("b680"),i("1285")),c=i("b775");function d(e){return Object(c["a"])({url:"/classes/Product",method:"get",params:e})}var l=i("4569"),u=i("d76c"),h={name:"ScreenHeadcount",props:{comp:{type:Object,default:function(){return{type:"line",width:400,hieght:72}}}},data:function(){return{item:{name:"产品数量",number:0,finename:"正常",finenumber:0,badname:"停用",badnumber:0}}},created:function(){var e=this;return Object(r["a"])(Object(o["a"])().mark((function t(){return Object(o["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:console.log("comp",e.comp),"product_count"==e.comp.id?(e.item.name="产品数量",e.item.finename="正常",e.item.badname="停用",e.queryProduct()):"device_count"==e.comp.id?(e.item.name="设备数量",e.item.finename="在线",e.item.badname="离线",e.queryDevice()):"warning_count"==e.comp.id?(e.item.name="告警数量",e.item.finename="已处理",e.item.badname="未处理",e.queryNotification()):"order_count"==e.comp.id&&(e.item.name="工单数量",e.item.finename="已处理",e.item.badname="未处理",e.getMaintenance());case 2:case"end":return t.stop()}}),t)})))()},mounted:function(){},methods:{handleTo:function(){this.comp.text&&this.$router.push({path:this.comp.text})},getMaintenance:function(){var e=this;return Object(r["a"])(Object(o["a"])().mark((function t(){var i,a,n,r,s,c;return Object(o["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return i={skip:0,order:"-createdAt",count:"objectId",where:{}},t.next=3,Object(u["a"])(i);case 3:a=t.sent,n=a.results,r=a.count,e.item.number=r,s=0,c=0,n.forEach((function(e){"2"==e.status?s++:c++})),e.item.finenumber=s,e.item.badnumber=c,e.item.percent=e.item.number>0?Number((e.item.finenumber/e.item.number*100).toFixed(1)):0;case 12:case"end":return t.stop()}}),t)})))()},queryNotification:function(){var e=this;return Object(r["a"])(Object(o["a"])().mark((function t(){var i,a,n,r,s,c;return Object(o["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return i={skip:0,order:"-createdAt",count:"objectId",where:{}},t.next=3,Object(l["a"])(i);case 3:a=t.sent,n=a.results,r=a.count,e.item.number=r,s=0,c=0,n.forEach((function(e){"0"==e.status?c++:s++})),e.item.finenumber=s,e.item.badnumber=c,e.item.percent=e.item.number>0?Number((e.item.finenumber/e.item.number*100).toFixed(1)):0;case 12:case"end":return t.stop()}}),t)})))()},queryProduct:function(){var e=this;return Object(r["a"])(Object(o["a"])().mark((function t(){var i,a,n;return Object(o["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return i={skip:0,order:"-createdAt",count:"objectId",where:{}},t.next=3,d(i);case 3:a=t.sent,a.results,n=a.count,e.item.number=n,e.item.finenumber=n,e.item.percent=e.item.number>0?Number((e.item.finenumber/e.item.number*100).toFixed(1)):0;case 9:case"end":return t.stop()}}),t)})))()},queryDevice:function(){var e=this;return Object(r["a"])(Object(o["a"])().mark((function t(){var i,a,n,r,c,d;return Object(o["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return i={skip:0,order:"-createdAt",count:"objectId",where:{}},t.next=3,Object(s["e"])(i);case 3:a=t.sent,n=a.results,r=a.count,e.item.number=r,c=0,d=0,n.forEach((function(e){"ONLINE"==e.status?c++:d++})),e.item.finenumber=c,e.item.badnumber=d,e.item.percent=e.item.number>0?Number((e.item.finenumber/e.item.number*100).toFixed(1)):0;case 12:case"end":return t.stop()}}),t)})))()}}},p=h,m=(i("55f4"),i("2877")),A=Object(m["a"])(p,a,n,!1,null,"42fce4da",null);t["a"]=A.exports},c766:function(e,t,i){"use strict";i("75c0")},cb78:function(e,t,i){},d03f:function(e,t,i){"use strict";i("38bc")},debc:function(e,t,i){},f2aa:function(e,t,i){"use strict";i("5f51")},f8d7:function(e,t,i){"use strict";i("6775")}}]);